---
import DemoLayout from "../../../layouts/DemoLayout.astro";
---
<DemoLayout>
  <div class="grid grid-cols-4 grid-rows-4 gap-3 justify-center items-center w-full max-w-xl mx-auto p-2">
    {
      (() => {
        const cartas = [
          "El_Gallo", "El_Diablo", "La_Dama", "El_Catrin", "El_Paraguas", "La_Sirena", "La_Escalera", "La_Botella", "El_Barril", "El_Arbol", "El_Melon", "El_Valiente", "El_Gorrito", "La_Muerte", "La_Pera", "La_Bandera", "El_Bandolon", "El_Violoncello", "La_Garza", "El_Pajaro"
        ];
        const cartasAleatorias = cartas
          .map((carta, idx) => ({ carta, idx: idx + 1 }))
          .sort(() => Math.random() - 0.5)
          .slice(0, 16);
        return cartasAleatorias.map(({ carta, idx }, i) => (
          <button class="relative border border-gray-200 rounded-lg overflow-hidden shadow hover:shadow-lg transition-shadow duration-300 aspect-[2/3] flex items-center justify-center bg-white p-1 loteria-btn" data-index={i}>
            <img src={`/Cards/${idx}_${carta}.avif`} alt={`Carta ${carta}`} class="w-full h-full object-contain max-h-48" />
            <span class="absolute inset-0 bg-white opacity-0 pointer-events-none transition-opacity duration-300 loteria-overlay"></span>
          </button>
        ));
      })()
    }
  </div>
  <div id="loteria-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-lg p-8 text-center">
      <h2 class="text-3xl font-bold text-blue-700 mb-4">¡Lotería!</h2>
      <button id="close-modal" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">Reiniciar</button>
    </div>
  </div>
</DemoLayout>
<script>
document.addEventListener('DOMContentLoaded', () => {
  let count = 0;
  const buttons = document.querySelectorAll('.loteria-btn');
  const modal = document.getElementById('loteria-modal');
  const closeModal = document.getElementById('close-modal');
  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const overlay = btn.querySelector('.loteria-overlay');
      if (overlay && overlay.style.opacity !== '1') {
        overlay.style.opacity = '1';
        count++;
        if (count === 16 && modal) {
          modal.classList.remove('hidden');
        }
      }
    });
  });
  if (closeModal && modal) {
    closeModal.onclick = () => {
      window.location.reload();
    };
  }
});
</script>